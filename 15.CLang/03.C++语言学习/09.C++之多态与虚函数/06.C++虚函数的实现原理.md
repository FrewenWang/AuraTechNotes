---
title: C++虚函数的实现原理
date: 2022-01-05 00:00:00
updated: 2022-01-05 00:00:00
type: [C++,虚函数,性能监控]
tags: [C++,虚函数,性能监控]
comments: 
description: 页面描述
keywords: 关键字
top_img:
mathjax:
katex:
aside:
aplayer:
highlight_shrink:
---

[TOC]

# 概述

首先。我们来说一下，C++中多态的表象，在基类函数前面加上virtual关键字，在派生类中重写该函数。运行时会根据对象的实际类型来调用相应的函数。如果对象类型是派生来，就调用派生类的函数。如果是基类就调用基类的函数。

实际上，当一个类中包含虚函数时，编译器会为该类生成一个虚函数表，保存该类中虚函数的地址。同样派生类继承，派生类中自然一定有虚函数，所以编译器也会为派生类生成自己的虚函数表。当我们定义一个派生类对象编译器会检测该类是否有虚函数，所以为这个派生类对象生成一个虚函数指针，指向该类型的虚函数表，这个虚函数指针的初始化实在构造函数中完成的。



# 构造函数不定义为虚函数

虚函数调用只需要知道“部分”的信息，即只需要知道函数的接口，而不需要知道对象的具体类型。但是，我们要创建一个对象的话，是需要知道对象的完整信息的。特别是，需要知道要创建对象的确切类型，因此，构造函数不应该被定义成虚函数。而且从目前编译器实现虚函数进行多态的方式来看，虚函数的调用是通过实例化之后对象的虚函数
# 概述

OpenCV是一个基于BSD开源许可发行的跨平台计算机视觉和机器学习软件库，可以运行在Linux、Windows、Android和Mac OS操作系统上。

总结起来就是OpenCV是计算机视觉中经典的专用库，其支持多语言、跨平台，功能强大且开源免费。

OpenCV提供了许多内置的用于图像处理和计算机视觉相关操作的基础元素，可用作图像处理操作、视频分析、3D重建、特征提取、 目标检测识别、机器学习等各大领域。

OpenCV的基础架构

![openCV架构图](https://gitee.com/frewen1225/ImageUploader/raw/master/img/20210821173112.awebp)



# 环境变量

## Homebrew安装

首先，使用 homebrew 安装 OpenCV (目前最新的版本是 4.4)。

```
brew install opencv
```

TODO 本人安装报错！！

## 通过源码安装

OpenCV下载地址：https://opencv.org/releases/

下载是对应源码下载地址：

```
https://codeload.github.com/opencv/opencv/zip/refs/tags/4.5.3

https://github.com/opencv/opencv_contrib/releases/tag/4.5.3
```

下载完成进行解压完成之后：进入下面/Users/frewen/03.ProgramStudy/15.CLang/04.Resources/01.OpenCV/opencv-4.5.3/build目录中。执行下面的脚本：

```shell
cmake .. -D CMAKE_BUILD_TYPE=RELEASE -D CMAKE_INSTALL_PREFIX=/Users/frewen/03.ProgramStudy/15.CLang/04.Resources/01.OpenCV/opencv-4.5.3/build  -D OPENCV_GENERATE_PKGCONFIG=ON -D INSTALL_C_EXAMPLES=ON -D BUILD_EXAMPLES=ON -D OPENCV_EXTRA_MODULES_PATH=/Users/frewen/03.ProgramStudy/15.CLang/04.Resources/01.OpenCV/opencv_contrib-4.5.3/modules


# 使用4个内核安装
make -j4

make install
```





# Hello World

编写一个 OpenCV 版本的 Hello World

上面的配置做完之后，我们来创建一个 HelloWorld 的项目

新创建的项目，默认使用 CMake 进行构建。因此，需要修改一下 CMakeLists.txt 文件

```cmake
cmake_minimum_required(VERSION 3.17)
project(HelloWorld)

set(CMAKE_CXX_STANDARD 14)

#find_library(OpenCV)
find_package(OpenCV)
include_directories( ${OpenCV_INCLUDE_DIRS} )

add_executable(HelloWorld main.cpp)

target_link_libraries(HelloWorld ${OpenCV_LIBS})
```



其中，需要注意的是

- find_package 是用于查找依赖包。
- include_directories 是用于添加 Headers 搜索路径，在这里将 OpenCV 的头文件添加到 include 路径。
- add_executable 是为工程生成一个可执行文件，并指定所使用的源文件。

add_executable 常用的语法如下：

>  add_executable(<name> [WIN32] [MACOSX_BUNDLE] [EXCLUDE_FROM_ALL] source1 source2 … sourceN) 

<name> 是生成的可执行目标文件，会根据本地平台创建出来。

- target_link_libraries 是为了将目标文件与库文件进行链接。

target_link_libraries 常用的语法如下：

>  target_link_libraries(<target> [item1] [item2] [...] [[debug|optimized|general] <item>] ...) 

<target>  是 add_executable 生成的目标文件。OpenCV_LIBS 是一个可执行文件的变量，表示 可以链接 OpenCV 库。



然后修改 main.cpp

```c++
#include <iostream>
#include <opencv2/opencv.hpp>

#include <opencv2/core.hpp>
#include <opencv2/highgui.hpp>
#include <opencv2/imgproc.hpp>

using namespace std;
using namespace cv;

int main() {

    Mat image = imread("test.jpg");
    if (image.empty()){
        printf("Image not loaded");
        return -1;
    }
    imshow("image", image);

    waitKey(0);
    return 0;
}
```

最后，将 test.jpg 文件放在工程中，就可以编译了。

## 编译

执行命令：

```shell
cmake .
```

然后再执行命令，用于生成可执行文件

```cmake
make
```

生成可执行文件.jpeg

对于已经生成好的可执行文件，通过如下命令来执行，就可以把图片展示出来了。

```c++
./HelloWorld
```

每次修改 C++ 代码，只需要执行 make 即可。



对于一些常见的错误，如：

```
Undefined symbols for architecture x86_64:
  "__ZN2cv6imreadERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEEi", referenced from:
      _main in main.cpp.o
  "__ZN2cv6imshowERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEERKNS_11_InputArrayE", referenced from:
      _main in main.cpp.o
ld: symbol(s) not found for architecture x86_64
collect2: error: ld returned 1 exit status
```

可以删除 CMakeCache.txt 文件，然后重新 make 一下即可。



# 归纳总结

在 Clion 中配置 OpenCV 的开发环境并不繁琐，只需要了解 CMake 即可。配置完之后，就可以开心的使用 OpenCV 处理图像了。
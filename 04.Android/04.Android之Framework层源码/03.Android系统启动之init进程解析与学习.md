源码分析基于Android9.0.0_r47

## 概述



我们先来看一下Android系统启动流程的全过程。

1. 按电源键
2. 进入开机动画
3. 经过漫长的等待
4. 开机动画结束
5. 正式开机，进入设置画面
6. 进入系统桌面（Launcher）



1.loader

刷过机的朋友大概都知道，Android可以通过某个组合按键进入BootLoader页面，这个也就是上图中的最底层，在Android系统，甚至于它的内核还未加载时的一个引导程序，主要负责对kenel进行解压和初始化的工作

2.idle进程

kernel中的idle进程是0号进程，由内核中启动，并始终执行在内核态，由内核态的idle进程开启我们常提的1号进程,init（对应源码，`system/core/init/init.cpp`）

3.init进程

`init.cpp`中做的事情其实不只是开启`init`进程，这个后面分析具体源码时再做详细介绍

init进程负责的事情主要是对`init.rc`这个系统启动脚本文件进行解析（`loadBootScripts()`），经过对`ro.zygote`对应的具体的架构的脚本文件进行解析，进行到第四步

4.zygote进程

zygote的进程的启动入口。我们找到对应的源码位置在`framework/base/cmds/app_process/app_main`

在`app_process`中把`app_main`运行的进程设置`process_name`为zygote，这也就是我们在执行`ps`指令时看到的`zygote`进程了,此时zygote还处于`native`层，通过jni调用`zygoteInit.java`中的`main`函数，正式进入`Java`世界,zygoteInit中又开启了`SystemServer`,进入第四步

5.SystemServer进程



6.Launcher

Launcher已经是我们具体的App应用了，这个是由zygote进程fork出来的进程



# init进程启动

init的源码位于`system/core/init`包下，我们先从入口类`main.cpp`来看


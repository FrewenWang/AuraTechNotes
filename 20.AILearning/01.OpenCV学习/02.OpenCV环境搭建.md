

# Anaconda安装OpenCV



```
conda install -c menpo opencv3=3.2.0
```

```
Fetching package metadata ...............
PackageNotFoundError: Package missing in current win-64 channels:
  - opencv3 3.2.0*
```

查了一下原來是 menpo 這個channel 的opencv3。

### 解決方法:

用 `conda-forge` 這個channel 就可以了:

```
conda install -c conda-forge opencv=3.2.0
Fetching package metadata ...............
Solving package specifications: .

```





# MacOS安装OpenCV



## Homebrew安装

首先，使用 homebrew 安装 OpenCV (目前最新的版本是 4.4)。

```
brew install opencv
```

TODO 本人安装报错！！

## 通过源码安装

![image-20211204210055512](images/02.OpenCV%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/image-20211204210055512.png)

当然我们也可以下载OpenCV的3.X的版本

比如：我们下载3.4.6版本：

https://opencv.org/releases/

https://github.com/opencv/opencv/tree/3.4.16

## 下载contrib的源码

然后我们同样下载contribe的

https://github.com/opencv/opencv_contrib

![image-20211204210734490](https://gitee.com/frewen1225/ImageUploader/raw/master/img/202112042107232.png)



OpenCV下载地址：https://opencv.org/releases/

下载是对应源码下载地址：

```
https://codeload.github.com/opencv/opencv/zip/refs/tags/4.5.3

https://github.com/opencv/opencv_contrib/releases/tag/4.5.3
```


安装OpenCV所需要的依赖库

```
sudo apt-get install cmake  libgtk2.0-dev libavcodec-dev libavformat-dev libjpeg.dev libpng-dev libtiff-dev libtiff4.dev libswscale-dev libjasper-dev libcurl4-openssl-dev libtbb2 libdc1394-22-dev
```



下载完成进行解压完成之后：

进入OpenCV的根目录里面，创建一个build目录

进入下面/Users/frewen/03.ProgramStudy/15.CLang/04.Resources/01.OpenCV/opencv-4.5.3/build目录中。执行下面的脚本：

```shell
frewen@FreweniUbuntu:~/03.ProgramSpace/20.AI/04.Resource/opencv-3.4.16$ pwd
/home/frewen/03.ProgramSpace/20.AI/04.Resource/opencv-3.4.16
frewen@FreweniUbuntu:~/03.ProgramSpace/20.AI/04.Resource/opencv-3.4.16$ mkdir build 
frewen@FreweniUbuntu:~/03.ProgramSpace/20.AI/04.Resource/opencv-3.4.16$ cd build 
```

下载完成进行解压完成之后：

进入下面/Users/frewen/03.ProgramStudy/20.AI/04.Resource/OpenCV/opencv-4.5.3/build目录中。执行下面的脚本：

```
cmake .. -D CMAKE_BUILD_TYPE=RELEASE -D CMAKE_INSTALL_PREFIX=/Users/frewen/Library/AFrewenLib/opencv4.5.3 -D OPENCV_GENERATE_PKGCONFIG=ON -D INSTALL_C_EXAMPLES=ON -D BUILD_EXAMPLES=ON -D OPENCV_EXTRA_MODULES_PATH=/Users/frewen/03.ProgramStudy/20.AI/04.Resource/OpenCV/opencv_contrib-4.5.3/modules

# 使用4个线程安装

make -j4

# 使用8个线程安装

# make -j8

make install
```

我们需要将opencv.pc中的pkgconfig文件复制到/usr/local/lib/pkgconfig，并将其命名为opencv4.pc。这样，如果你已经安装了OpenCV 3.x.x，则不会发生冲突。让我们继续：
```
export DYLB_LIBRARY_OPENCV_PATH=/Users/frewen/Library/AFrewenLib/opencv4.5.3/lib:$DYLB_LIBRARY_OPENCV_PATH
```

我们需要将opencv.pc中的pkgconfig文件复制到/usr/local/lib/pkgconfig，并将其命名为opencv4.pc。这样，如果你已经安装了OpenCV 3.x.x，则不会发生冲突。让我们继续：

```shell
cp /Users/frewen/Library/AFrewenLib/opencv4.5.3/lib/pkgconfig/opencv4.pc  /usr/local/lib/pkgconfig/opencv4.pc  
```

我们还需要更新PKG_CONFIG_PATH变量。请打开~/.profile文件并添加以下命令行：

```shell
export PKG_CONFIG_PATH=/usr/local/lib/pkgconfig/:$PKG_CONFIG_PATH
```

使用以下命令重新加载~/.profile文件：

综上环境变量设置：

```shell
export DYLB_LIBRARY_OPENCV_PATH=/Users/frewen/Library/AFrewenLib/opencv4.5.3/lib:$DYLB_LIBRARY_OPENCV_PATH
export PKG_CONFIG_PATH=/usr/local/lib/pkgconfig/:$PKG_CONFIG_PATH
```







# Ubuntu上搭建OpenCV环境



OpenCV下载地址：https://opencv.org/releases/

下载是对应源码下载地址：

```
https://codeload.github.com/opencv/opencv/zip/refs/tags/4.5.3

https://github.com/opencv/opencv_contrib/releases/tag/4.5.3
```

安装OpenCV所需要的依赖库

```
sudo apt-get install cmake  libgtk2.0-dev libavcodec-dev libavformat-dev libjpeg.dev libpng-dev libtiff-dev libtiff4.dev libswscale-dev libjasper-dev libcurl4-openssl-dev libtbb2 libdc1394-22-dev
```



下载完成进行解压完成之后：

进入OpenCV的根目录里面，创建一个build目录

进入下面/Users/frewen/03.ProgramStudy/15.CLang/04.Resources/01.OpenCV/opencv-4.5.3/build目录中。执行下面的脚本：

```shell
frewen@FreweniUbuntu:~/03.ProgramSpace/20.AI/04.Resource/opencv-3.4.16$ pwd
/home/frewen/03.ProgramSpace/20.AI/04.Resource/opencv-3.4.16
frewen@FreweniUbuntu:~/03.ProgramSpace/20.AI/04.Resource/opencv-3.4.16$ mkdir build 
frewen@FreweniUbuntu:~/03.ProgramSpace/20.AI/04.Resource/opencv-3.4.16$ cd build 

cmake .. -D CMAKE_BUILD_TYPE=RELEASE -D CMAKE_INSTALL_PREFIX=/home/frewen/03.ProgramSpace/20.AI/04.Resource/opencv-3.4.16/build -D OPENCV_GENERATE_PKGCONFIG=ON -D INSTALL_C_EXAMPLES=ON -D BUILD_EXAMPLES=ON -D OPENCV_EXTRA_MODULES_PATH=/home/frewen/03.ProgramSpace/20.AI/04.Resource/opencv_contrib-3.4.16/modules
..

# 

# 使用4个内核安装
make -j4

make install
```





# Hello World

编写一个 OpenCV 版本的 Hello World

上面的配置做完之后，我们来创建一个 HelloWorld 的项目

新创建的项目，默认使用 CMake 进行构建。因此，需要修改一下 CMakeLists.txt 文件

```cmake
cmake_minimum_required(VERSION 3.17)
project(HelloWorld)

set(CMAKE_CXX_STANDARD 14)

#find_library(OpenCV)
find_package(OpenCV)
include_directories( ${OpenCV_INCLUDE_DIRS} )

add_executable(HelloWorld main.cpp)

target_link_libraries(HelloWorld ${OpenCV_LIBS})
```



其中，需要注意的是

- find_package 是用于查找依赖包。
- include_directories 是用于添加 Headers 搜索路径，在这里将 OpenCV 的头文件添加到 include 路径。
- add_executable 是为工程生成一个可执行文件，并指定所使用的源文件。

add_executable 常用的语法如下：

>  add_executable(<name> [WIN32] [MACOSX_BUNDLE] [EXCLUDE_FROM_ALL] source1 source2 … sourceN) 

<name> 是生成的可执行目标文件，会根据本地平台创建出来。

- target_link_libraries 是为了将目标文件与库文件进行链接。

target_link_libraries 常用的语法如下：

>  target_link_libraries(<target> [item1] [item2] [...] [[debug|optimized|general] <item>] ...) 

<target>  是 add_executable 生成的目标文件。OpenCV_LIBS 是一个可执行文件的变量，表示 可以链接 OpenCV 库。



然后修改 main.cpp

```c++
#include <iostream>
#include <opencv2/opencv.hpp>

#include <opencv2/core.hpp>
#include <opencv2/highgui.hpp>
#include <opencv2/imgproc.hpp>

using namespace std;
using namespace cv;

int main() {

    Mat image = imread("test.jpg");
    if (image.empty()){
        printf("Image not loaded");
        return -1;
    }
    imshow("image", image);

    waitKey(0);
    return 0;
}
```

最后，将 test.jpg 文件放在工程中，就可以编译了。

## 编译

执行命令：

```shell
cmake .
```

然后再执行命令，用于生成可执行文件

```cmake
make
```

生成可执行文件.jpeg

对于已经生成好的可执行文件，通过如下命令来执行，就可以把图片展示出来了。

```c++
./HelloWorld
```

每次修改 C++ 代码，只需要执行 make 即可。



对于一些常见的错误，如：

```
Undefined symbols for architecture x86_64:
  "__ZN2cv6imreadERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEEi", referenced from:
      _main in main.cpp.o
  "__ZN2cv6imshowERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEERKNS_11_InputArrayE", referenced from:
      _main in main.cpp.o
ld: symbol(s) not found for architecture x86_64
collect2: error: ld returned 1 exit status
```

可以删除 CMakeCache.txt 文件，然后重新 make 一下即可。



# 归纳总结

在 Clion 中配置 OpenCV 的开发环境并不繁琐，只需要了解 CMake 即可。配置完之后，就可以开心的使用 OpenCV 处理图像了。

















